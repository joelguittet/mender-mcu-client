# @file      build.yml
# @brief     Used to build mender-mcu-client and test application
#
# Copyright joelguittet and mender-mcu-client contributors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: build

on:
  push:
    branches:
      - '**'
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  build:
    name: Build
    runs-on: ubuntu-24.04
    steps:
      # Install tools
      - name: Install tools
        run: |
          wget -q -O - https://github.com/curl/curl/archive/refs/tags/curl-8_8_0.tar.gz | tar xz
          cd curl-curl-8_8_0 && autoreconf -fi && ./configure --with-openssl --enable-websockets --enable-versioned-symbols && make -j$(nproc) && sudo make install
          wget -q -O - https://github.com/msgpack/msgpack-c/archive/refs/tags/c-6.0.0.tar.gz | tar xz
          cd msgpack-c-c-6.0.0 && cmake . -DMSGPACK_BUILD_TESTS=OFF -DMSGPACK_BUILD_EXAMPLES=OFF && make -j$(nproc) && sudo make install
          sudo ldconfig

      # Checkout mender-mcu-client
      - name: Checkout mender-mcu-client
        uses: actions/checkout@v5
        with:
          path: mender-mcu-client

      # Build test application
      - name: Build test application
        working-directory: mender-mcu-client
        run: |
            # Create build directory
            cd tests
            mkdir -p build
            cd build
            # Build weak use cases:
            # - No add-ons
            # - Configure add-on only with/without storage
            # - Inventory add-on only
            # - Troubleshoot add-on only with/without shell/file transfer
            # - All add-ons
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=OFF
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=OFF -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=OFF -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/weak" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/weak" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            # Build ESP-IDF use cases:
            # - NVS storage option
            # - mbedtls/cryptoauthlib TLS options
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="esp-idf" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="esp-idf" -DCONFIG_MENDER_PLATFORM_NET_TYPE="esp-idf" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="freertos" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="esp-idf/nvs" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/mbedtls" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="esp-idf" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="esp-idf" -DCONFIG_MENDER_PLATFORM_NET_TYPE="esp-idf" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="freertos" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="esp-idf/nvs" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/cryptoauthlib" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            # Build nRF Connect SDK use cases:
            # - NVS/PSA ITS/PSA PS storage option
            # - mbedtls/cryptoauthlib/PSA Crypto TLS options
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/dfu_target" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="zephyr/nvs" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/mbedtls" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/dfu_target" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="zephyr/nvs" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/cryptoauthlib" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/dfu_target" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/psa_its" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/psa_crypto" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/dfu_target" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/psa_ps" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/psa_crypto" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            # Build Zephyr use cases:
            # - NVS/PSA ITS/PSA PS storage option
            # - mbedtls/cryptoauthlib/PSA Crypto TLS options
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/flash_img" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="zephyr/nvs" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/mbedtls" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/flash_img" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="zephyr/nvs" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/cryptoauthlib" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/flash_img" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/psa_its" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/psa_crypto" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="zephyr/flash_img" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_NET_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="zephyr" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="generic/psa_ps" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/psa_crypto" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
            # Build Posix use cases:
            # - curl network option
            # - mbedtls TLS option
            cmake .. -G "Unix Makefiles" -DCONFIG_MENDER_PLATFORM_FLASH_TYPE="posix" -DCONFIG_MENDER_PLATFORM_LOG_TYPE="posix" -DCONFIG_MENDER_PLATFORM_NET_TYPE="generic/curl" -DCONFIG_MENDER_PLATFORM_SCHEDULER_TYPE="posix" -DCONFIG_MENDER_PLATFORM_STORAGE_TYPE="posix" -DCONFIG_MENDER_PLATFORM_TLS_TYPE="generic/mbedtls" -DCONFIG_MENDER_CLIENT_ADD_ON_CONFIGURE=ON -DCONFIG_MENDER_CLIENT_CONFIGURE_STORAGE=ON -DCONFIG_MENDER_CLIENT_ADD_ON_INVENTORY=ON -DCONFIG_MENDER_CLIENT_ADD_ON_TROUBLESHOOT=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_SHELL=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_FILE_TRANSFER=ON -DCONFIG_MENDER_CLIENT_TROUBLESHOOT_PORT_FORWARDING=ON
            make -j$(nproc)
